# 6 - Test Access Controls

## 6.1 Understand the Access Control Requirements

| # | Description |
| :---: | :--- |
| 6.1.1 | Based on the core functionality implemented within the application, understand the broad requirements for access control in terms of vertical segregation (different levels of users have access to different types of functionality) and horizontal segregation (users at the same privilege level have access to different subsets of data). Often, both types of segregation are present. For example, ordinary users may be able to access their own data, while administrators can access everyone’s data. |
| 6.1.2 | Review your application mapping results to identify the areas of functionality and types of data resources that represent the most fruitful targets for privilege escalation attacks. |
| 6.1.3 | To perform the most effective testing for access control vulnerabilities, you should ideally obtain a number of different accounts with different vertical and horizontal privileges. If self-registration is possible, you can probably obtain the latter directly from the application. To obtain the former, you will probably need the cooperation of the application owner (or need to exploit some vulnerability to gain access to a high-privileged account). The availability of different kinds of accounts will affect the types of testing you can perform, as described next.822 Chapter 21 n A Web Application Hacker’s Methodology |


## 6.2 Test with Multiple Accounts

| # | Description |
| :---: | :--- |
| 6.2.1 | If the application enforces vertical privilege segregation, first use a powerful account to locate all the functionality it can access. Then use a less-privileged account and attempt to access each item of this functionality. |
| 6.2.1.1 | Using Burp, browse all the application’s content within one user context. |
| 6.2.1.2 | Review the contents of Burp’s site map to ensure you have identified all the functionality you want to test. Then, log out of the application and log back in using a different user context. Use the context menu to select the “compare site maps” feature to determine which high-privileged requests may be accessible to the lower-privileged user. See Chapter 8 for more details on this technique. |
| 6.2.2 | If the application enforces horizontal privilege segregation, perform the equivalent test using two different accounts at the same privilege level, attempting to use one account to access data belonging to the other account. This typically involves replacing an identifier (such as a document ID) within a request to specify a resource belonging to the other user. |
| 6.2.3 | Perform manual checking of key access control logic. |
| 6.2.3.1 | For each user privilege, review resources available to a user. Attempt to access those resources from an unauthorized user account by replaying the request using the unauthorized user’s session token. |
| 6.2.4 | When you perform any kind of access control test, be sure to test every step of multistage functions individually to confirm whether access controls have been properly implemented at each stage, or whether the application assumes that users who access a later stage must have passed security checks implemented at the earlier stages. For example, if an administrative page containing a form is properly protected, check whether the actual form submission is also subjected to proper access controls. |

 
# 6.3 Test with Limited Access

| # | Description |
| :---: | :--- |
| 6.3.1 | If you do not have prior access to accounts at different privilege levels, or to multiple accounts with access to different data, testing for broken access controls is not quite as straightforward. Many common vulnerabilities will be much harder to locate, because you do not know the names of the URLs, identifiers, and parameters that are needed to exploit the weaknesses.Chapter 21 n A Web Application Hacker’s Methodology 823 |
| 6.3.2 | In your application mapping exercises that use a low-privileged account, you may have identified the URLs for privileged functions such as administrative interfaces. If these are not adequately protected, you will probably already know about this. |
| 6.3.3 | Decompile all compiled clients that are present, and extract any references to server-side functionality. |
| 6.3.4 | Most data that is subject to horizontal access controls is accessed using an identifier, such as an account number or order reference. To test whether access controls are effective using only a single account, you must try to guess or discover the identifiers associated with other users’ data. If possible, generate a series of identifiers in quick succession (for example, by creating several new orders). Attempt to identify any patterns that may enable you to predict the identifiers issued to other users. If there is no way to generate new identifiers, you are probably restricted to analyzing those you already have and guessing on that basis. |
| 6.3.5 | If you find a way to predict the identifiers issued to other users, use the techniques described in Chapter 14 to mount an automated attack to harvest interesting data belonging to other users. Use the Extract Grep function in Burp Intruder to capture the relevant information from within the application’s responses.|


# 6.4 Test for Insecure Access Control Methods

| # | Description |
| :---: | :--- |
| 6.4.1 | Some applications implement access controls based on request parameters in an inherently unsafe way. Look for parameters such as edit=false or access=read in any key requests, and modify these in line with their apparent role to try to interfere with the application’s access control logic. |
| 6.4.2 | Some applications base access control decisions on the HTTP Referer header. For example, an application may properly control access to /admin.jsp and accept any request showing this as its Referer. To test for this behavior, attempt to perform some privileged actions to which you are authorized, and submit a missing or modified Referer header. If this change causes the application to block your request, it may be using the Referer header in an unsafe way. Try performing the same action as an unauthorized user, but supply the original Referer header and see whether the action succeeds. |
| 6.4.3 | If HEAD is an allowed method on the site, test for insecure containermanaged access control to URLs. Make a request using the HEAD method to determine whether the application permits it. |
